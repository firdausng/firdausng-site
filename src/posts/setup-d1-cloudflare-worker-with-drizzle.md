---
title: 'Setting up D1 Database with Drizzle in a Hono Cloudflare Worker App'
date: "2025-01-12"
description: This guide covers configuring a D1 database using Drizzle in a Hono app deployed using Cloudflare Workers.. 🚀
categories:
  - cloudflare worker
  - cloudflare D1
  - Hono
  - Drizzle
author: Me
published: true
featured: true
---


This guide covers configuring a D1 database using Drizzle in a Hono app deployed using Cloudflare Workers.

To create a cloudflare worker app, we just need to run below command.
```bash
pnpm create hono@latest
# Ensure that you select "Cloudflare Workers" as the deployment target
```

in the `wrangler.toml` , add D1 database config, ensure that `migrations_dir` set to folder called `migrations`. This will be the migration file created by drizzle later.
```toml
[[ d1_databases ]]  
binding = "DB"  
database_name = "Hono DB"  
database_id = "abcdabcd-abcd-abcd-abcd-abcdabcdabcd" 
migrations_dir = "migrations"
```
Note: The `database_name` and `database_id` will come from your Cloudflare dashboard later. For local development, you can use any values for now.

# Update Bindings
create the typescript type file for the Cloudflare binding.
```shell
wrangler types src/worker.d.ts
```
this creates a typescript type file called `worker.d.ts`. this file will contain the Cloudflare binding as we defined `wrangler.toml` file.
```ts
// Generated by Wrangler by running `wrangler types src/worker.d.ts`  
  
interface Env {  
    DB: D1Database;  
}
```

To integrate this into our Hono app, we create a type file as per below
```ts
// src/types.d.ts
import type {RequestIdVariables} from "hono/request-id";  
import {Hono} from "hono";  
  
export type App = {  
    Bindings: Env,  
    Variables: RequestIdVariables  
}  
  
export type AppOpenAPi = Hono<App>;
```


Under `src/index.ts`, add a basic Hono app.
```ts
import { Hono } from 'hono'  
import {App} from "./types";  
  
const app = new Hono<App>()  
  
app.get('/', (c) => {  
  return c.text('Hello World')  
})  
  
export default app
```

# Drizzle Integration

To add drizzle into the created project,  we need to install its dependencies
```bash
pnpm add drizzle-orm  
pnpm add -D drizzle-kit
```

Then we need to add a drizzle config file
```ts
//drizzle.config.ts
import { defineConfig } from 'drizzle-kit';  
  
export default defineConfig({  
    out: './migrations',  
    schema: './src/db/schema.ts',  
    dialect: 'sqlite',  
});
```
This config file will only be used for Db migration.

Now we need to add Drizzle schema that will be used to generate the Db migration script
```ts
//src/db/schema.ts
import { int, sqliteTable, text } from "drizzle-orm/sqlite-core";  
  
export const users = sqliteTable("users", {  
    id: int().primaryKey({ autoIncrement: true }),  
    name: text().notNull(),  
    age: int().notNull(),  
    email: text().notNull().unique(),  
});
```

to generate a migration, we need to run below command
```shell
pnpm drizzle-kit generate
```

Drizzle will create a migration code under migrations folder

to push this migration to the database, we need to run below command
```shell
wrangler d1 migrations apply "Hono DB"
# `Hono DB` is the value under `db name` that we defined in `wrangler.toml`
```

the command below will actually run on local Miniflare.

# Integrate with Hono
Now we can update our Hono app to access the `users` table
```ts
//src/index.ts

import { Hono } from 'hono'  
import {App} from "./types";  
import { drizzle } from 'drizzle-orm/d1';  
import {users} from "./db/schema";  
  
const app = new Hono<App>()  
  
app.get('/', (c) => {  
  return c.text(c.env.my_secret)  
})  
  
app.get('/users', async (c) => {  
  const db = drizzle(c.env.DB);  
  const result = await db.select().from(users).all()  
  return c.json(result)  
})  
  
app.post('/users', async (c) => {  
  const jsonData = await c.req.json();  
  const db = drizzle(c.env.DB);  
  const result = await db.insert(users).values(jsonData)  
  
  return c.json(result)  
})  
  
  
export default app

```


# Drizzle Studio
Drizzle Studio is a feature provided by Drizzle to make working with drizzle become much easier.
this feature usually use a lot during development. However, the we cannot use the current drizzle config because that required us to point to local sqlite file which we dont have (kinda). so we should create a new drizzle config file named `drizzle-dev.config.ts`
```ts
import type { Config } from "drizzle-kit";  
  
const config: Config = {  
    out: './migrations',  
    schema: './src/db/schema.ts',  
    dialect: 'sqlite',  
    dbCredentials: {  
        url: "",
    },  
};  
  
export default config;
```
Find your local SQLite file path:
- Look under `.wrangler/state/v3/d1/miniflare-D1DatabaseObject`
- Update the `url` in the config with the full path, e.g.:
  `"file:.wrangler/state/v3/d1/miniflare-D1DatabaseObject/3b553bae5256c5b08dde7a22ca1f24582e24203302bf1da3989e3550b9dc0b07.sqlite"`

To run Drizzle studio
```shell
pnpm drizzle-kit studio --config=drizzle-dev.config.ts
```

# Push to cloudflare

first you need to ensure the database is created in cloudflare, to create new D1 db, just run below command
```shell
npx wrangler d1 create "Hono DB"
```

this command will return you a response similar to this
```
✅ Successfully created DB 'Hono DB App' in region WNAM
Created your new D1 database.

[[d1_databases]]
binding = "DB"
database_name = "Hono DB"
database_id = "abcdabcd-abcd-abcd-abcd-abcdabcdabcd"
```
we can use this information to update our `wrangler.toml` file

Then we can run below command to update this db
```
wrangler d1 migrations apply "Hono DB" --remote true
```


# References
https://developers.cloudflare.com/workers/wrangler/commands/#d1-migrations-apply

